SELECT U.NAME, U.SEX, U.BYEAR
FROM U, P, UP
WHERE U.UID = UP.UID AND P.PID = UP.PID
  AND P.TITLE = '核酸'
  AND YEAR(UP.CKDATE) = 2020
  AND MONTH(UP.CKDATE) = 3
ORDER BY U.BYEAR DESC;


SELECT P.PID, COUNT(*) AS DetectionCount
FROM P, UP
WHERE P.PID = UP.PID
  AND YEAR(UP.CKDATE) = 2020
  AND MONTH(UP.CKDATE) <= 6
GROUP BY P.PID
HAVING COUNT(*) >= 500;


UPDATE U
SET FLAG = 1
WHERE UID IN (
    SELECT UP.UID
    FROM UP, P
    WHERE P.PID = UP.PID
      AND P.TITLE = '双抗'
);
